# Microservice with Open Search gateway for Rust
A microservice that publish a Rest API based on [salvo.rs](https://salvo.rs/)

## Requirements
- Just install [rust](https://www.rust-lang.org/tools/install) from page

```Shell
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

### Production Requirements

```Shell
apt install pkg-config openssl libssl-dev
```

## Getting Started

### Deploy with docker

You can build images using the follow command

```
docker build -t opensearch-gateway-rs -f docker/Dockerfile .
```

After build just run it

```
docker run -d -p 7878:7878 --name opensearch-gateway-rs -e KAFKA_ENABLED="N" -e KAFKA_QUEUES="menu" -e KAFKA_HOST="0.0.0.0:29092" -e KAFKA_GROUP="default" -e OPENSEARCH_URL="http://localhost:9200" opensearch-gateway-rs
```

#### Environment variables
- `HOST`: Internal host for container. Default: `0.0.0.0:7878`
- `KAFKA_ENABLED`: Define if the kafka consumer is enabled. Default: `N`
- `KAFKA_QUEUES`: Apply for `KAFKA_ENABLED` flag, this can subscribe to many topics using space between topic. Default: `menu`
- `KAFKA_HOST`: Kafka cluster and port for connect. Default: `0.0.0.0:29092`
- `KAFKA_GROUP`: Kafka group for subscription. Default: `default`
- `OPENSEARCH_URL`: Open Search service host and port. Default `http://localhost:9200`
- `RUST_LOG`: The log level for service. Default `info`
- `TZ`: (Time Zone) Indicates the time zone to set in the nginx-based container, the default value is `America/Caracas` (UTC -4:00).

### Running project
Just build it and run

```Shell
cargo build
cargo run --bin server
```

### Console Output
A output generated by the Arduino UNO emulator can be like it:

```Shell
Server Address: "0.0.0.0:7878"
 └──!NULL!
    └──v1/menus
        └──[GET] -> server::get_menu
```
