# Microservice with PostgreSQL for Rust
A microservice that publish a Rest API based on [salvo.rs](https://salvo.rs/)

## Requirements
- Just install [rust](https://www.rust-lang.org/tools/install) from page

```Shell
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

- [Diesel](https://diesel.rs/guides/getting-started)

### Production Requirements

```Shell
apt install pkg-config openssl libssl-dev libsqlite3-dev
```

### Install dielsel cli

```Shell
cargo install diesel_cli --no-default-features --features sqlite
```

### Create the Database enviroment variable

```Shell
echo DATABASE_URL=time_attendance.db > .env
```

### Setup diesel

```Shell
diesel setup
```

### Add SQLs for Migration

```Shell
diesel migration generate setup
```

### Apply all Migrations

```Shell
diesel migration run
```

### For redo all Migration

```Shell
diesel migration redo
```

## Getting Started

### Deploy with docker

You can build images using the follow command

```
docker build -t microservice-postgresql-rs -f docker/Dockerfile .
```

After build just run it

```
docker run -d -p 7878:7878 --name microservice-postgresql-rs -e DB_NAME="adempiere" -e DB_HOST="localhost" -e DB_NAME="adempiere" -e DB_USER="adempiere" -e DB_PASSWORD="adempiere" microservice-postgresql-rs-rs
```

#### Environment variables
- `DB_HOST`: Hostname for data base server. Default: `localhost`
- `DB_PORT`: Port used by data base server. Default: `5432`
- `DB_NAME`: Database name that adempiere-middleware will use to connect with the database. Default: `adempiere`
- `DB_USER`: Database user that adempiere-middleware will use to connect with the database. Default: `adempiere`
- `DB_PASSWORD`: Database password that Adempiere-Backend will use to connect with the database. Default: `adempiere`
- `ADEMPIERE_BACKEND_ENDPOINT`: Backend endpoint for all request to ADempiere, default is `http://0.0.0.0:7878/v1/entities`
- `ADEMPIERE_AUTHORIZATION`: Private key used for validate sign with [JWT](https://jwt.io/introduction), default `Bearer`. This throw a error if is notr setted
- `RUST_LOG`: The log level for service. Default `info`
- `TZ`: (Time Zone) Indicates the time zone to set in the nginx-based container, the default value is `America/Caracas` (UTC -4:00).

### Running project
Just build it and run

```Shell
cargo build
cargo run --bin server
```

### Console Output
A output generated by the Arduino UNO emulator can be like it:

```Shell
Server Address: "0.0.0.0:7878"
└──!NULL!
    └──attendances
        └──[POST] -> server::v1/order_lines
```
